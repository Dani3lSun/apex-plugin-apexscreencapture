var apexScreenCapture={parseBoolean:function(e){var t;return"true"==e.toLowerCase()&&(t=!0),"false"==e.toLowerCase()&&(t=!1),"true"!=e.toLowerCase()&&"false"!=e.toLowerCase()&&(t=void 0),t},clob2Array:function(e,t,n){loopCount=Math.floor(e.length/t)+1;for(var a=0;a<loopCount;a++)n.push(e.slice(t*a,t*(a+1)));return n},dataURI2base64:function(e){var t=e.substr(e.indexOf(",")+1);return t},svg2canvas:function(e,t){try{var n,a,r=$(e).find("svg");r.each(function(){n=document.createElement("canvas"),n.className="tempCanvas",$(this).attr("width",$(this).innerWidth()),$(this).attr("height",$(this).innerHeight()),a=(new XMLSerializer).serializeToString(this),a=a.replace(/xmlns=\"http:\/\/www\.w3\.org\/2000\/svg\"/,""),canvg(n,a),$(n).insertAfter(this),$(this).attr("class","tempHide"),$(this).hide()}),t()}catch(e){t()}},convertImage2PDF:function(e){var t,n=new jsPDF("l","mm","a4"),a=e.toDataURL("image/jpeg"),r=e.width,o=e.height,i=r/o,l=n.internal.pageSize.getWidth(),c=n.internal.pageSize.getHeight(),u=l/c;if(i>=1)if(t=r/l,i>=u)n.addImage(a,"JPEG",0,(c-o/t)/2,l,o/t,null,"NONE");else{var s=u/i;n.addImage(a,"JPEG",(l-l/s)/2,0,l/s,o/s/t,null,"NONE")}else if(t=r/c,1/i>u){var p=1/i/u,d=(c-o/p/t)/4;n.addImage(a,"JPEG",(l-o/p/t)/2,-(o/p/t+d),c/p,o/p/t,null,"NONE",-90)}else n.addImage(a,"JPEG",(l-o/t)/2,-(o/t),c,o/t,null,"NONE",-90);return n},getImage:function(e,t,n,a,r){var o;if("application/pdf"===a){var i=apexScreenCapture.convertImage2PDF(t);o=i.output("datauristring")}else o=t.toDataURL(a);if("Y"===n)"application/pdf"===a?window.open(i.output("bloburl"),"_blank"):window.open().document.write('<img src="'+o+'" />'),r();else{var l=apexScreenCapture.dataURI2base64(o),c=[];c=apexScreenCapture.clob2Array(l,3e4,c),apex.server.plugin(e,{f01:c,x01:a},{dataType:"html",success:function(){$("body").trigger("screencapture-saved-db"),r()},error:function(e,t){$("body").trigger("screencapture-error-db"),console.log("getImage: apex.server.plugin ERROR:",t),r()}})}},doHtml2Canvas:function(e,t,n,a,r,o,i,l,c,u){u&&(console.log("doHtml2Canvas: HTML element:",e),console.log("doHtml2Canvas: element width:",r),console.log("doHtml2Canvas: element height:",o));var s=apex.util.showSpinner($("body"));s.attr("data-html2canvas-ignore","true"),apexScreenCapture.svg2canvas("body",function(){html2canvas($(e),{onrendered:function(e){apexScreenCapture.getImage(n,e,t,c,function(){s.remove()})},background:a,width:r,height:o,letterRendering:i,allowTaint:l,logging:u}),$("body").find(".tempCanvas").remove(),$("body").find(".tempHide").show().removeClass("tempHide")})},doHtml2CanvasDom:function(e,t,n,a,r,o,i,l){pWidth=$(e).width(),pHeight=$(e).height(),l&&(console.log("doHtml2CanvasDom: Clicked element:",e),console.log("doHtml2CanvasDom: element width:",pWidth),console.log("doHtml2CanvasDom: element height:",pHeight));var c=apex.util.showSpinner($("body"));c.attr("data-html2canvas-ignore","true"),apexScreenCapture.svg2canvas("body",function(){html2canvas($(e),{onrendered:function(e){apexScreenCapture.getImage(n,e,t,i,function(){c.remove()})},background:a,width:pWidth,height:pHeight,letterRendering:r,allowTaint:o,logging:l}),$("body").find(".tempCanvas").remove(),$("body").find(".tempHide").show().removeClass("tempHide")})},captureScreen:function(){var e,t,n,a=this,r=a.action.ajaxIdentifier,o=a.action.attribute01,i=a.action.attribute02,l=a.action.attribute04,c=parseInt(a.action.attribute05),u=parseInt(a.action.attribute06),s=apexScreenCapture.parseBoolean(a.action.attribute07),p=apexScreenCapture.parseBoolean(a.action.attribute08),d=apexScreenCapture.parseBoolean(a.action.attribute09),g=a.action.attribute10,m=a.action.attribute11,h=apexScreenCapture.parseBoolean(a.action.attribute12),v=apexScreenCapture.parseBoolean(a.action.attribute13),b=a.action.attribute14,f=a.action.attribute15;if("body"!==o?(t=parseInt($(o).innerWidth()),n=parseInt($(o).innerHeight())):(t=parseInt(document.documentElement.clientWidth),n=parseInt(document.documentElement.clientHeight)),c&&(t=c),u&&(n=u),null!==m&&void 0!==m||(m=!1),null!==h&&void 0!==h||(h=!1),null!==v&&void 0!==v||(v=!1),e="PNG"==f?"image/png":"JPEG"==f?"image/jpeg":"PDF"==f?"application/pdf":"image/png",d&&(console.log("captureScreen: Attribute JQuery selector:",o),console.log("captureScreen: Attribute open window:",i),console.log("captureScreen: Attribute background:",l),console.log("captureScreen: Attribute element width:",t),console.log("captureScreen: Attribute element height:",n),console.log("captureScreen: Attribute letter rendering:",s),console.log("captureScreen: Attribute allow taint:",p),console.log("captureScreen: Attribute Logging:",d),console.log("captureScreen: Attribute DOM selector:",g),console.log("captureScreen: Attribute DOM filter:",m),console.log("captureScreen: Attribute hide label:",h),console.log("captureScreen: Attribute fill content:",v),console.log("captureScreen: Attribute border color:",b),console.log("captureScreen: Attribute image mime-type:",e)),"Y"==g){var C=function(t){apexScreenCapture.doHtml2CanvasDom(t,i,r,l,s,p,e,d)},S=DomOutline({onClick:C,filter:m,stopOnClick:!0,borderColor:b,hideLabel:h,fillContent:v});S.start()}else apexScreenCapture.doHtml2Canvas(o,i,r,l,t,n,s,p,e,d)}};